## Описание проекта

Это небольшой сервис‑планировщик задач на Python, упакованный в Docker‑контейнер.  
Проект рассчитан на развёртывание на сервере с использованием Docker и Docker Compose.

Исходный код репозитория:  
`https://github.com/RomanZorkin/time-schedular.git`

## Требования к серверу

- **ОС**: любой Linux с доступом в интернет.
- **Docker**: установлен и запущен демон Docker.
- **Docker Compose**: либо в виде плагина `docker compose` (современные версии Docker), либо отдельный бинарник `docker-compose`.
- **Права**: пользователь с правами запускать Docker (обычно `root` или пользователь в группе `docker`).

Проверить, что Docker установлен и работает:

```bash
docker --version
docker compose version  # или docker-compose --version
```

## Структура репозитория (кратко)

- `app/` – исходный код приложения (планировщик).
- `Dockerfile` – инструкция сборки Docker‑образа.
- `docker-compose.yml` – конфигурация сервиса для запуска через Docker Compose.
- `logs/` – каталог для логов планировщика (монтируется внутрь контейнера).
- `pyproject.toml`, `uv.lock` – описание Python‑зависимостей (управляются через `uv`).

## Шаг 1. Клонирование репозитория

На сервере выполните:

```bash
cd /opt  # или любой другой каталог, где хотите разместить проект
git clone https://github.com/RomanZorkin/time-schedular.git
cd time-schedular
```

Убедитесь, что рядом с `Dockerfile` лежит `docker-compose.yml`, а также каталог `app/`.

## Шаг 2. Подготовка каталогов и прав

Каталог `logs/` уже присутствует в репозитории и будет проброшен в контейнер.  
Если вы меняете структуру или клонируете в нестандартное место, убедитесь, что:

- каталог `logs/` существует;
- у пользователя, от имени которого запускается Docker, есть права записи в этот каталог.

Проверка и создание при необходимости:

```bash
mkdir -p logs
chmod 755 logs
```

## Шаг 3. Сборка и запуск через Docker Compose

Находясь в корне проекта (там, где лежат `docker-compose.yml` и `Dockerfile`), выполните:

```bash
docker compose up -d --build
```

Если у вас установлена старая версия Docker Compose как отдельный бинарник, используйте:

```bash
docker-compose up -d --build
```

Что делает эта команда:

- **`--build`** – собирает образ на основе `Dockerfile`;
- **`-d`** – запускает контейнер в фоне (detached mode).

После успешного запуска появится контейнер с именем `reliable-scheduler` (см. `docker-compose.yml`).

## Шаг 4. Проверка статуса сервиса

Проверить, что контейнер запущен:

```bash
docker ps
```

Вы должны увидеть сервис `reliable-scheduler` со статусом `Up` и без ошибок.

В `docker-compose.yml` настроен **healthcheck**, который периодически проверяет, что Python‑окружение и библиотека `schedule` доступны.  
Если контейнер не проходит проверку, он может перезапускаться в соответствии с политикой `restart: always`.

## Шаг 5. Просмотр логов приложения

Логи можно смотреть двумя способами.

- **Через Docker**:

```bash
docker logs -f reliable-scheduler
```

Флаг `-f` позволяет “подписаться” на поток логов.

- **Через файловую систему**:

Логи пишутся в каталог `logs/` на хосте (он проброшен в `/app/logs` внутри контейнера).  
Вы можете читать файлы обычными средствами:

```bash
ls logs
tail -f logs/scheduler.log  # имя файла может отличаться, посмотрите список файлов
```

## Шаг 6. Остановка и перезапуск сервиса

- **Остановить сервис**:

```bash
docker compose down
```

или (для старых установок):

```bash
docker-compose down
```

- **Перезапустить сервис после изменения кода или зависимостей**:

```bash
docker compose down
docker compose up -d --build
```

Если вы не меняли зависимости и достаточно просто перезапустить контейнер:

```bash
docker compose restart
```

## Обновление проекта до последней версии из GitHub

Если на GitHub появились новые коммиты, на сервере можно обновить код так:

```bash
cd /путь/к/time-schedular
git pull
docker compose up -d --build
```

После этого контейнер будет пересобран с последними изменениями.

## Дополнительные замечания

- Все чувствительные данные (если появятся в будущем: токены, пароли и т.п.) рекомендуется выносить в переменные окружения и задавать их через блок `environment` в `docker-compose.yml` или через `.env` файл (по стандартам Docker Compose).
- Текущая конфигурация ориентирована на **одиночный сервис‑планировщик**, не требующий внешней БД. При расширении функциональности (БД, очереди и т.п.) добавляйте новые сервисы в `docker-compose.yml`.

На этом базовое развёртывание на сервере через Docker Compose завершено.

